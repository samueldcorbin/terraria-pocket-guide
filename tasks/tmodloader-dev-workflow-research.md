# tModLoader Mod Development Workflow Research

Research completed 2026-02-22. Focused on tModLoader 1.4.4+ / v2025 stable.

## 1. Project Structure

A tModLoader mod lives in `Documents/My Games/Terraria/tModLoader/ModSources/<ModName>/`.

### Required files:
- **`build.txt`** - Mod metadata (displayName, author, version, modReferences, side, etc.)
- **`<ModName>.cs`** - Main mod class. Exactly one class extending `Mod` per mod. Central entry point.
- **`<ModName>.csproj`** - MSBuild project file for Visual Studio / dotnet build. Generated by "Create Mod" button.
- **`Properties/launchSettings.json`** - Debug launch config (path to tModLoader for F5 debugging).

### Optional files:
- **`description.txt`** - Mod description for the mod browser.
- **`icon.png`** - 64x64 mod icon.
- **`icon_workshop.png`** - Workshop icon.

### Typical folder structure:
```
MyMod/
  build.txt
  description.txt
  icon.png
  MyMod.cs                    # Main Mod class
  MyMod.csproj
  Properties/launchSettings.json
  Content/
    Items/                    # ModItem subclasses
    NPCs/                     # ModNPC subclasses
    Projectiles/              # ModProjectile subclasses
    Tiles/                    # ModTile subclasses
    Buffs/                    # ModBuff subclasses
  Sounds/                     # .ogg audio files
  Localization/               # .hjson localization files
```

### Example .csproj (from ExampleMod):
```xml
<?xml version="1.0" encoding="utf-8"?>
<Project Sdk="Microsoft.NET.Sdk">
  <Import Project="..\tModLoader.targets" />
  <PropertyGroup>
    <AssemblyName>ExampleMod</AssemblyName>
    <LangVersion>latest</LangVersion>
  </PropertyGroup>
</Project>
```

The `tModLoader.targets` file is provided by tModLoader and handles all framework references, target framework specification, and build integration. You do NOT manually set `<TargetFramework>` -- the targets file handles it.

### Key build.txt properties:
- `displayName` - Display name
- `author` - Author name
- `version` - Version string (2-4 numbers, e.g., 1.0.0.0)
- `modReferences` - Required mod dependencies
- `weakReferences` - Optional mod dependencies
- `noCompile` - If true, uses pre-compiled DLL instead of compiling .cs files (default: false)
- `includeSource` - Include .cs files in distributed .tmod (default: false)
- `includePDB` - Include debug symbols for stack traces (default: false; increases size)
- `hideCode` - Hide DLL/PDB in extracted mod
- `hideResources` - Hide resources in extracted mod
- `buildIgnore` - Glob patterns to exclude from build (e.g., `*.csproj, *.user, obj\*, bin\*, .vs\*`)
- `side` - Client/Server/Both/NoSync (default: Both)
- `sortAfter` / `sortBefore` - Load order control
- `homepage` - URL
- `dllReferences` - External DLLs (must be in `lib/` folder)

## 2. Build/Reload Cycle

### Primary workflow: In-game "Build + Reload"
1. Workshop > Develop Mods > find your mod > "Build + Reload"
2. tModLoader compiles all .cs files using MSBuild/Roslyn
3. Produces a `.tmod` file (custom binary format containing compiled DLL + assets)
4. Reloads mods without fully restarting Terraria (returns to main menu, reloads, then you can rejoin)
5. Takes ~5-10 seconds for small mods

### Visual Studio workflow:
1. Open the .csproj in Visual Studio 2022
2. Press F5 or click the debug button
3. VS builds the mod, launches tModLoader with debugging attached
4. Breakpoints, variable inspection, stepping all work

### "Edit and Continue" (Hot Reload):
- Windows-only, Visual Studio feature
- Enabled via the `-eac` launch argument (set up automatically by generated projects)
- Allows modifying C# code while the game is running and applying changes without restarting
- Limitations: cannot change method signatures, add new classes, etc. (standard EnC restrictions)
- This is the closest thing to true hot-reload

### There is NO true hot-reload of mod code while staying in a world.
"Build + Reload" kicks you back to the main menu. Edit and Continue is the closest alternative, but it has the standard .NET limitations on what can be changed at runtime.

## 3. Developer Tools

### Built-in tModLoader tools:
- **Developer Mode** - Toggle in bottom-right of main menu. Required for mod development.
- **Mod Sources menu** - Workshop > Develop Mods. Create, build, reload, publish mods.
- **"Build + Reload" button** - Compile and reload without restarting Terraria.
- **"Upgrade .csproj" button** - Converts old mod projects to current format.

### Logging:
- `Mod.Logger.Info("message")` / `.Warn()` / `.Error()` / `.Fatal()` / `.Debug()`
- From non-Mod classes: `ModContent.GetInstance<MyMod>().Logger.Info("msg")`
- Uses log4net library
- Logs go to: `client.log`, `server.log` (in tModLoader save directory)
- Old logs archived in `Old/` subfolder

### In-game text debugging:
- `Main.NewText("message")` - Shows in chat
- `CombatText.NewText(rect, color, "text")` - Floating world text
- `Dust.QuickDust()` / `Dust.QuickBox()` / `Dust.QuickDustLine()` - Geometry visualization with particles

### Visual Studio debugging:
- Full breakpoint support
- Variable inspection (hover, Locals, Autos windows)
- Step through code (F10 = step over, F11 = step into)
- Can step into decompiled tModLoader source
- Edit and Continue for live code changes

### Command-line arguments:
- `-eac` - Enable Edit and Continue
- `-skipselect "Player:World"` - Skip character/world selection, auto-load
- `-build <path>` - Build mod from source (headless, for CI/automation)
- `-modpack <name>` - Load specific mod pack
- `-modpath <path>` - Custom .tmod folder location
- `-savedirectory <path>` / `-tmlsavedirectory <path>` - Custom save location
- `cli-argsConfig.txt` in install dir loads arguments automatically

### Third-party tools:
- "Mod Reloader" (Steam Workshop) - Community mod for easier reloading
- "Debug Tools" (Steam Workshop) - Additional in-game debug utilities
- tModCodeAssist - Code assistance tool

## 4. Best Practices for Fast Iteration

1. **Use "Build + Reload" from in-game** rather than restarting Terraria each time.
2. **Use Visual Studio with Edit and Continue** (`-eac`) for the fastest inner loop -- change code while the game runs.
3. **Use `-skipselect "PlayerName:WorldName"`** to skip the character/world selection screens.
4. **Use windowed mode** for easier alt-tabbing between IDE and game.
5. **Launch from Visual Studio (F5)** to get automatic build + debug attach.
6. **Use launch profiles** to configure different testing scenarios without changing code.
7. **Keep mods small and focused** - smaller mods compile faster.
8. **Use `Main.NewText()` liberally** for quick printf-style debugging.
9. **Build in-game before release** - VS builds don't respect `buildIgnore` and produce larger .tmod files.
10. **Use `includePDB = true` in build.txt during development** for line numbers in stack traces.
11. **Test with new character/world** to isolate bugs from save data issues.

## 5. C# / .NET Version and Build Requirements

### Target Framework: .NET 8.0
- tModLoader v2024.03+ stable requires .NET 8.0 SDK
- Earlier 1.4 versions used .NET 6.0; that is no longer current
- The `tModLoader.targets` file sets the target framework; you don't specify it manually in .csproj

### C# Language Version: Latest
- The ExampleMod sets `<LangVersion>latest</LangVersion>`
- This means you get access to the latest C# features supported by the SDK (C# 12 with .NET 8 SDK)

### Build Requirements:
- **.NET 8.0 SDK** (not just runtime)
- **Visual Studio 2022 v17.8+** (if using VS) with ".NET desktop development" workload
- OR **Visual Studio Code** with C# Dev Kit extension
- OR **JetBrains Rider**
- OR just the .NET 8 SDK + any text editor (build from in-game)

### Platform preprocessor symbols:
- Windows: `WINDOWS;XNA` (uses XNA Framework)
- Linux/Mac: `LINUX;FNA;MONO` (uses FNA instead of XNA)
- Server: `SERVER`

## 6. How Mods Get Loaded

### Compilation: tModLoader compiles .cs files itself (by default)
- When you click "Build + Reload" or use `-build`, tModLoader invokes MSBuild/Roslyn to compile all .cs files in your mod source directory
- The compiled DLL is packaged into a `.tmod` file along with assets
- The `noCompile = true` option in build.txt skips compilation and uses a pre-built DLL from `lib/` instead

### .tmod file format (binary):
1. **Header**: "TMOD" magic bytes + tModLoader version string
2. **Hash**: 20-byte SHA1 checksum
3. **Signature**: 256-byte signature (for mod browser verification)
4. **Data length**: UInt32
5. **Metadata**: mod name, version, file count
6. **File catalog**: entries with filename, uncompressed size, compressed size
7. **File data**: DEFLATE-compressed file contents

### Loading sequence:
1. tModLoader reads `.tmod` files from the Mods directory
2. Extracts the compiled DLL (assembly) from the .tmod
3. Loads the assembly using Cecil for verification and PDB processing
4. Instantiates the `Mod` class
5. Calls mod lifecycle hooks (Load, PostSetupContent, etc.)

### Mod unloading:
- Mods must properly unload during reload (required for mod browser publishing)
- tModLoader enforces reload testing before upload
- The Unload() lifecycle method is called, then the assembly is discarded
